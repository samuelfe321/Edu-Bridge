<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login – Dynamite Systems</title>
    <link rel="stylesheet" href="css style/logReg.css" />
    <link rel="stylesheet" href="css style/access.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body data-theme="standard" data-tts="off">
    <!-- Accessibility Toggle – Icon Buttons -->
    <div
      class="access-toggle"
      role="region"
      aria-label="Accessibility options"
      style="left: 67%"
    >
      <button
        id="themeBtn"
        class="access-btn"
        title="Toggle Dark Mode"
        aria-label="Toggle Dark Mode"
        aria-pressed="false"
      >
        <i class="fas fa-moon"></i>
        <span class="sr-only">Dark Mode</span>
      </button>
      <button
        id="ttsBtn"
        class="access-btn"
        title="Toggle Text-to-Speech"
        aria-label="Toggle Text-to-Speech"
        aria-pressed="false"
      >
        <i class="fas fa-volume-up"></i>
        <span class="sr-only">Text-to-Speech</span>
      </button>
    </div>

    <main>
      <form id="loginForm" novalidate>
        <div class="login-header">
          <h1>Dynamite Systems</h1>
          <h1>Login</h1>
          <p>Secure access</p>
        </div>
        <div class="field">
          <label for="loginEmail">Email</label>
          <input
            type="email"
            id="loginEmail"
            required
            placeholder="you@example.com"
          />
        </div>
        <div class="field password-field">
          <label for="loginPassword">Password</label>
          <div class="password-wrapper">
            <input
              type="text"
              id="loginPassword"
              required
              minlength="8"
              maxlength="12"
              placeholder="••••••••"
            />
            <button
              type="button"
              class="toggle-password"
              aria-label="Show password"
            >
              <i class="fa fa-eye"></i>
            </button>
          </div>
        </div>
        <p class="forgot-password">
          <a href="#" id="forgotLink">Forgot Password?</a>
        </p>
        <button type="submit" class="submit-btn">Sign In</button>

        <!-- OAuth Buttons -->
        <div class="oauth-group">
          <p class="oauth-or">or continue with</p>
          <div class="oauth-buttons">
            <button
              type="button"
              class="oauth-btn google"
              onclick="oauthLogin('google')"
            >
              <i class="fab fa-google"></i> Google
            </button>
            <button
              type="button"
              class="oauth-btn apple"
              onclick="oauthLogin('apple')"
            >
              <i class="fab fa-apple"></i> Apple
            </button>
            <button
              type="button"
              class="oauth-btn microsoft"
              onclick="oauthLogin('microsoft')"
            >
              <i class="fab fa-microsoft"></i> Microsoft
            </button>
          </div>
        </div>

        <p class="create-account">
          <a href="reg.html">Create Account</a>
        </p>
      </form>
    </main>

    <!-- Reset Password Modal -->
    <div id="resetModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <button class="modal-close" aria-label="Close">×</button>
        <h2>Forgot Password</h2>
        <form id="resetForm" novalidate>
          <div class="field">
            <label for="resetEmail">Email</label>
            <input
              type="email"
              id="resetEmail"
              required
              placeholder="you@example.com"
            />
          </div>
          <button type="submit" class="submit-btn">Send Reset Link</button>
        </form>
      </div>
    </div>

    <script src="js/shared.js"></script>
    <script src="js/login.js">
          // Inside user-login.html <script>
      setTimeout(() => window.location.href = 'profile.html', 800);
    </script>

    <script>
      // js/login.js
      (() => {
        "use strict";

        // ==============================================
        // 1. ADD DEMO USER (ONCE)
        // ==============================================

        (function addDemoUser() {
          let demoUser = {
            name: "Collins Samuel",
            email: "Samuel@gmail.com",
            password: "556678",
            role: "student",
            joined: "2025-01-10T00:00:00Z",
          };          

          let users = JSON.parse(localStorage.getItem("users") || "[]");
          if (!users.some((u) => u.email === demoUser.email)) {
            users.push(demoUser);
            localStorage.setItem("users", JSON.stringify(users));
            console.log("Demo user added: user@edubridge.ng");
          }
        })();

        // ==============================================
        // 2. LOGIN FORM + REDIRECT TO profile.html
        // ==============================================
        const loginForm = document.getElementById("loginForm");
        const emailInput = document.getElementById("loginEmail");
        const passwordInput = document.getElementById("loginPassword");
        const statusMsg = document.createElement("p");
        statusMsg.id = "loginStatus";
        statusMsg.setAttribute("role", "status");
        statusMsg.setAttribute("aria-live", "polite");
        statusMsg.style.marginTop = "1rem";
        statusMsg.style.fontWeight = "500";
        loginForm.appendChild(statusMsg);

        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();

          const email = emailInput.value.trim();
          const password = passwordInput.value;

          const users = JSON.parse(localStorage.getItem("users") || "[]");
          const user = users.find(
            (u) => u.email === email && u.password === password
          );

          if (user) {
            localStorage.setItem("currentUser", JSON.stringify(user));
            statusMsg.textContent = "Login successful!";
            statusMsg.style.color = "#2e7d32";
            setTimeout(() => {
              window.location.href = "profile.html"; // EXACT REDIRECT
            }, 800);
          } else {
            statusMsg.textContent = "Invalid email or password.";
            statusMsg.style.color = "#d32f2f";
          }
        });

        // Optional: Pre-fill demo credentials
        emailInput.value = "Samuel@gmail.com";
        passwordInput.value = "556678";
      })();
    </script>
  </body>
</html>
